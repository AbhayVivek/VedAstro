@page "/sunrisesettime"
@using Genso.Astrology.Library


<PageTitle>Sun Rise And Set Time</PageTitle>

<h2>Sunrise:@_sunRiseTime</h2>
<h2>Sunset:@_sunSetTime</h2>

<GeoLocationInput @bind-LocationName="_locationName" @bind-Longitude="_longitude" @bind-Latitude="_latitude" />

<div style="margin-top: 50px" class="row">
    <button type="submit" @onclick="UpdateSunRiseSetTime" class="btn btn-primary">Update</button>
</div>

@code {

    private string? _sunSetTime = "";
    private string? _sunRiseTime = "";
    private string? _locationName = "";
    private double _longitude;
    private double _latitude;
    public bool PageReady { get; set; }


    //auto calculate sun rise/set time every time location is changed
    //called every time after the component has finished rendering
    protected override void OnAfterRender(bool firstRender) => UpdateSunRiseSetTime();


    private void UpdateSunRiseSetTime()
    {
        //parse location received from user
        var geoLocation = new GeoLocation(_locationName, _longitude, _latitude);

        //get time now
        var timeNow = Time.Now(geoLocation);

        var rise = AstronomicalCalculator.GetSunriseTime(timeNow);
        var set = AstronomicalCalculator.GetSunsetTime(timeNow);

        //show lmt time as string
        _sunRiseTime = rise.GetStdDateTimeOffsetText();
        _sunSetTime = set.GetStdDateTimeOffsetText();

    }

}